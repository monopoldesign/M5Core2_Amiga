/******************************************************************************
* M5Core2_Amiga
* (C)2021 M.Volkel
*
* Wifi-Functions
*******************************************************************************/

// Comment templates

/******************************************************************************
*
*******************************************************************************/

/*------------------------------------------------------------------------------
-
------------------------------------------------------------------------------*/

/******************************************************************************/

/******************************************************************************
* Header-Files
*******************************************************************************/
#include "main.h"
#include "M5Settings.h"
#include "M5Wifi.h"

/******************************************************************************
* Functions
*******************************************************************************/

/*------------------------------------------------------------------------------
-
------------------------------------------------------------------------------*/
void m5wifi_initWifi(void)
{
	WiFi.mode(WIFI_STA);
	WiFi.begin(globalSettings->wifiSsid, globalSettings->wifiPwd);

	uint32_t _time = millis();

	while (WiFi.status() != WL_CONNECTED)
	{
		if (millis() - _time > 10000)
			break;

		Serial.print(".");
		delay(1000);
	}

	Serial.println();

	if (WiFi.status() == WL_CONNECTED)
	{
		globalSettings->wifiConnected = true;
		Serial.print("IP: ");
		Serial.println(WiFi.localIP());
	}
}

/*------------------------------------------------------------------------------
-
------------------------------------------------------------------------------*/
void m5wifi_scanWifi(void)
{
	uint8_t n = WiFi.scanNetworks();

	for (uint8_t i = 0; i < n; i++)
	{
		Serial.print(i + 1);
		Serial.print(": ");
		Serial.print(WiFi.SSID(i));
		Serial.print(" (");
		Serial.print(WiFi.RSSI(i));
		Serial.print(")");
		Serial.println((WiFi.encryptionType(i) == WIFI_AUTH_OPEN) ? " " : "*");
		delay(10);
	}
}
